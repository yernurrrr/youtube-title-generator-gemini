import streamlit as st
import os
from google import genai
from google.genai.errors import APIError

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø API –ò –ú–û–î–ï–õ–ò ---
# –ö–ª—é—á GEMINI_API_KEY –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω –∏–∑ Streamlit Secrets (–∏–ª–∏ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
MODEL_NAME = "gemini-2.5-flash"

def generate_titles(prompt_text, style):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ Gemini, –≤–∫–ª—é—á–∞—è –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å."""
    if not GEMINI_API_KEY:
        # –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–∫–∞–∂–µ—Ç—Å—è, –µ—Å–ª–∏ –∫–ª—é—á –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Streamlit Secrets –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
        return "–û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω GEMINI_API_KEY. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞ SCS –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)."

    client = genai.Client(api_key=GEMINI_API_KEY)

    # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç), –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –º–æ–¥–µ–ª—å "—ç–∫—Å–ø–µ—Ä—Ç–æ–º"
    # *** –ò–°–ü–û–õ–¨–ó–£–ï–ú –í–´–ë–û–† –°–¢–ò–õ–Ø –í –ü–†–û–ú–ü–¢–ï ***
    system_instruction = (
        f"–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã—Ö –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è YouTube-–≤–∏–¥–µ–æ. –¢–≤–æ–π —Å—Ç–∏–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: '{style}'. "
        "–û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–∫–æ–º –∏–∑ 5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –Ω–µ –¥–æ–±–∞–≤–ª—è—è –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤."
    )

    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç
    full_prompt = (
        f"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π 5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è YouTube-–≤–∏–¥–µ–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π —Ç–µ–º—ã: '{prompt_text}'"
    )

    try:
        response = client.models.generate_content(
            model=MODEL_NAME,
            contents=full_prompt,
            config={"system_instruction": system_instruction}
        )
        return response.text
    except APIError as e:
        return f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ API: {e}"
    except Exception as e:
        return f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}"

# --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê STREAMLIT ---

st.set_page_config(page_title="–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ó–∞–≥–æ–ª–æ–≤–∫–æ–≤", layout="centered")
st.title("üî• –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è YouTube (MVP)")

# 1. –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Ç–µ–º—ã
text_input = st.text_input("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –≤–∞—à–µ–≥–æ –≤–∏–¥–µ–æ:", placeholder="–ö–∞–∫ –±—ã—Å—Ç—Ä–æ –≤—ã—É—á–∏—Ç—å Python", key="topic")

# 2. –ü–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Å—Ç–∏–ª—è (–ù–û–í–´–ô –≠–õ–ï–ú–ï–ù–¢)
style_selection = st.selectbox(
    "–í—ã–±–µ—Ä–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π —Å—Ç–∏–ª—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:",
    options=["–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π", "–ö–ª–∏–∫–±–µ–π—Ç–Ω—ã–π (–∏–Ω—Ç—Ä–∏–≥—É—é—â–∏–π)", "–Æ–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π", "–°–µ—Ä—å–µ–∑–Ω—ã–π"],
    key="style"
)

if st.button("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å üöÄ"):
    if text_input:
        st.info("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.")

        # *** –ü–ï–†–ï–î–ê–ß–ê –°–¢–ò–õ–Ø –í –§–£–ù–ö–¶–ò–Æ ***
        result_text = generate_titles(text_input, style_selection)

        # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        st.success("‚úÖ –ì–æ—Ç–æ–≤–æ! –í–∞—à–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏:")
        st.markdown(result_text)

    else:
        st.warning("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞")
